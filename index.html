<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta name="viewport" id="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />

<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

<link rel="stylesheet" href="estiloph.css">

<script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
<script type="text/javascript" charset="utf-8" src="SQLitePlugin.js"></script>

<script type="text/javascript" charset="utf-8">

document.addEventListener("deviceready", onDeviceReady, false);
function onDeviceReady() {


var db = window.sqlitePlugin.openDatabase({name: "my.db"});
show();
db.transaction(function(tx) {
tx.executeSql('CREATE TABLE IF NOT EXISTS mydata (id integer primary key, name text, email text)');
});


$(document).on('click', '#creat', function(){
var name = $("#name").val();
var email = $("#email").val();
db.transaction(function(transaction) {
var executeQuery = "INSERT INTO mydata (name, email) VALUES (?,?)";
transaction.executeSql(executeQuery, [name,email]
, function(tx, result) {
show();
},
function(error){
//filter(function(aSome) {alert('Error occurred');
});
});
});


function show(){
db.transaction(function(transaction) {
transaction.executeSql('SELECT * FROM mydata', [], function (tx, results) {
var key = "";


var pair="<tr><th data-priority=\"1\"><center>Id</center></th><th data-priority=\"1\"><center>Name</center></th><th data-priority=\"2\"><center>Email</center></th><th><center>Update</center></th><th><center>Delete</center></th></tr>";
var i=0;


var len = results.rows.length, i;
for (i=0; i<=len-1; i++) {


key = results.rows.item(i).name;


id = results.rows.item(i).id;


pair += "<tr><td><center>"+id+"</center></td><td><center>"+key+"</center></td><td><center>"+results.rows.item(i).email+"</center></td><td><a class=\"update\" href=\"#myPopupDialog\" data-custom="+"'"+ id+ "'" +"data-rel=\"popup\" data-position-to=\"window\" data-transition=\"pop\"><center><i class='fa fa-pencil-square-o'></i></center></a></td><td><a id=\"delete\" data=\""+id+"\"><center><i class='fa fa-trash'></i></center></a></td></tr>";
}
if (pair == "<tr><th>Name</th><th>Email</th></tr>") {
pair += "<tr><td><i>empty</i></td><td><i>empty</i></td></tr>";
}
$("#myTable").html(pair);
}, null);
});
}


$(document).on('click', '#delete', function(){
var id = $(this).attr("data");
db.transaction(function(transaction) {
transaction.executeSql("DELETE FROM mydata where id=?", [id],
function(tx, result) {
show();
},
function(error){
// alert('Something went Wrong');
});
});
});


$(document).on('click', '#upd', function(){
var id = $("#id").val();
var name = $("#uname").val();
var email = $("#uemail").val();
db.transaction(function(transaction) {
var executeQuery = "";
transaction.executeSql("UPDATE mydata SET name=?, email=? WHERE id=?", [name,email,id],
function(tx, result) {alert('Updated successfully');
show();
},
function(error){alert('Something went Wrong');});
});
});
$(document).on('click', '.update', function(){
var id = $(this).attr('data-custom');
$("#id").val(id);
db.transaction(function(transaction) {
transaction.executeSql('SELECT name,email FROM mydata where id=?', [id], function (tx, results) {
var name = results.rows.item(0).name;
var email = results.rows.item(0).email;
$("#uname").val(name);
$("#uemail").val(email);
},
function(error){
alert('Something went Wrong');
});
});
});


$(document).on('click', '#clearall', function(){
db.transaction(function(transaction) {
transaction.executeSql("DELETE FROM mydata", [],
function(tx, result) {alert('Delete successfully');
show();
},
function(error){alert('Something went Wrong');});
});
});
}

</script>
</head>
<body>
	<div data-role="page">
	
	<!--Header Bar-->
	<div data-role="header" data-position="fixed" class="ui-header ui-bar-a ui-header-fixed slidedown" role="banner">
	<h1>Store Me</h1>
	</div>
	
	<!--Beginning of the Name and Email Field Div-->
	<div data-role="main" class="ui-content" id="main">
	<center><p id="heading">CRUD Operations Using SQLite Plugin</p></center>
	<center><img src="img/phonegap-sqlite-plugin-img.png"/></center>
	<div class="ui-grid-a">
	<div class="ui-block-a"><div class="ui-bar ui-bar-a">
	<center><label for="text-basic">Name</label></center>
	<input type="text" name="text-basic" id="name" placeholder="Name">
	</div></div>
	<div class="ui-block-b"><div class="ui-bar ui-bar-a">
	<center><label for="text-basic">Email</label></center>
	<input type="text" name="text-basic" id="email" placeholder="Email">
	</div></div>
	</div>
	<!--End of the Name and Email Field Div-->
	
	<!--Beginning of the Create and Clear All Div-->
	<fieldset class="ui-grid-a" id="btndiv">
	<div class="ui-block-a"><div class="ui-bar ui-bar-a">
	<a href="#" id ="creat" onclick="create()">
	<center><i class="fa fa-pencil"> Create</i></center>
	</a></div>
	</div>
	<!--End of the Create and Clear All Button Div-->
	
	<!--Dialog Box when clicked on Clear All button-->
	<div class="ui-block-b"><div class="ui-bar ui-bar-a">
	<a id ="bt" href="#popupDialog" data-rel="popup" data-position-to="window" data-transition="pop" class="ui-btn ui-corner-all ui-shadow " >
	<center><i class="fa fa-scissors"> Clear All</i></center>
	</a></div>
	</div>
	</fieldset>
	<div data-role="popup" id="popupDialog" data-dismissible="false" style="max-width:400px;">
	<div data-role="header" data-theme="a">
	<h1>Clear All?</h1>
	</div>
	<div role="main" class="ui-content">
	<h3 class="ui-title">Are you sure you want to clear local storage?</h3>
	<center><b><p>This action cannot be undone.</p></b></center>
	<center> <a href="#" id ="clearall" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" data-rel="back" data-transition="flow">Yes! I'm Sure</a><a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" data-rel="back">Cancel</a></center>
	</div>
	</div>
	<!-- End of the Clear All Dialog Box-->
	
	<!--Table Displaying Database Rows-->
	<table data-role="table" data-mode="reflow" class="ui-responsive ui-shadow" id="myTable">
	</table>
	
	<!--Dialog Box when clicked on update button-->
	<div data-role="main" class="ui-content">
	<div data-role="popup" id="myPopupDialog">
	<div data-role="header">
	<h1>Update</h1>
	</div>
	<div data-role="main" class="ui-content">
	<form method="post">
	<div class="ui-field-contain">
	<table id="utable">
	<tr>
	<td><label for="id">Id:</label></td>
	<td><input disabled="disabled" type="text" name="id" id="id" placeholder="Id" value=""></td>
	</tr>
	<tr>
	<td><label for="name">Name:</label></td>
	<td><input type="text" name="name" id="uname" placeholder="Name" value=""></td>
	</tr>
	<tr>
	<td><label for="email">Email:</label></td>
	<td><input type="email" name="email" id="uemail" placeholder="Enter Your New Email"></td>
	</tr>
	</table>
	</div>
	<center><a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" data-rel="back" id="upd" data-transition="flow">Update</a> <a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" data-rel="back">Cancel</a>
	</center>
	</form>
	</div>
	</div>
	</div>
	</div>

	</body>
</html>